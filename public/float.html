<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‚Ä¶</title>
<link rel="stylesheet" href="styles.css">
<script src="sound.js" defer></script>
<style>
/* ‡πÄ‡∏û‡∏¥‡πà‡∏° style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
.krathong-float-page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.message-section {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  text-align: center;
}

.message-card {
  max-width: 680px;
  width: 100%;
  padding: 32px 24px;
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(5px);
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,.3);
}

.message-card h2 {
  font-size: 2rem;
  margin: 0 0 20px;
  color: #fff;
}

.message-card .wish-text {
  font-size: 1.2rem;
  line-height: 1.8;
  color: #fff;
  background: rgba(255,255,255,.08);
  padding: 20px;
  border-radius: 12px;
  margin: 16px 0;
}

.message-card .name-highlight {
  color: #ff9f0a;
  font-weight: 600;
}

/* ‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏•‡∏≠‡∏¢ */
.river-section {
  height: 280px;
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(5px);
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,.3);
}

/* ‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏•‡∏π‡∏Å */
.floating-krathong {
  position: absolute;
  bottom: 50%;
  transform: translateY(50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  animation: floatAnimation 25s linear infinite;
}


.floating-krathong img {
  width: 140px;
  height: auto;
  filter: drop-shadow(0 4px 12px rgba(0,0,0,0.4));
}

.floating-krathong .owner-name {
  position: absolute;
  top: -36px;
  background: rgba(255,159,10,0.95);
  color: #fff;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

@keyframes floatAnimation {
  0% { 
    left: -200px;
    transform: translateY(50%) rotate(-2deg);
  }
  25% {
    transform: translateY(45%) rotate(1deg);
  }
  50% {
    transform: translateY(55%) rotate(-1deg);
  }
  75% {
    transform: translateY(48%) rotate(2deg);
  }
  100% { 
    left: calc(100% + 200px);
    transform: translateY(50%) rotate(-2deg);
  }
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
.action-buttons {
  padding: 24px 16px;
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
  background: rgba(0,0,0,0.15);
}

@media (max-width: 640px) {
  .message-card h2 { font-size: 1.5rem; }
  .message-card .wish-text { font-size: 1rem; }
  .floating-krathong img { width: 110px; }
  .river-section { height: 220px; }
}
</style>
</head>
<body class="krathong-float-page">

<!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô -->
<div class="message-section">
  <div class="message-card">
    <h2>ü™î ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á</h2>
    <div class="wish-text" id="wishDisplay">
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
    </div>
    <p style="margin-top:20px; opacity:0.8; font-size:0.95rem;">
      ‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏≠‡∏¢‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏≤‡∏£‡∏ñ‡∏ô‡∏≤‡∏î‡∏µ‡πÜ
    </p>
  </div>
</div>

<!-- ‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏•‡∏≠‡∏¢ -->
<div class="river-section" id="riverArea">
  <!-- ‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö -->
<div class="action-buttons">
  <a id="shareLine" class="btn">‡πÅ‡∏ä‡∏£‡πå LINE</a>
  <a id="shareFB" class="btn">‡πÅ‡∏ä‡∏£‡πå Facebook</a>
  <a class="btn ghost" href="index.html">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
</div>

<footer class="foot">
  <small>¬© 2025 Loy Krathong Online by Ayub</small>
</footer>
<iframe src="music.html" allow="autoplay" style="display:none"></iframe>
<script>
const API = "api";

function esc(s) {
  return String(s).replace(/[&<>"']/g, m => ({
    '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":"&#39;"
  }[m]));
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
async function loadRecentKrathongs() {
  try {
    const res = await fetch(`${API}/recent.php?limit=20`, {cache:'no-store'});
    const data = await res.json();
    return data.items || [];
  } catch(e) {
    console.error('Error loading krathongs:', e);
    return [];
  }
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏•‡∏≠‡∏¢‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥
function createFloatingKrathongs(krathongs) {
  const river = document.getElementById('riverArea');
  
  if (krathongs.length === 2) return;
  
  krathongs.forEach((k, idx) => {
    const div = document.createElement('div');
    div.className = 'floating-krathong';
    
    // ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const startOffset = -300 - (idx * 180);
    div.style.left = startOffset + 'px';
    div.style.animationDelay = `${idx * 2}s`;
    
    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡∏£‡∏∞‡∏ó‡∏á
    const designPath = k.design || 'assets/krathong1.PNG';
    
    div.innerHTML = `
      <span class="owner-name">${esc(k.name)}</span>
      <img src="${esc(designPath)}" alt="krathong">
    `;
    
    river.appendChild(div);
  });
}

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå
/**
 * Sets up the sharing buttons for LINE and Facebook with the user's name and wish.
  const text = `${esc(name)} ‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ${esc(wish)}`;
 * @param {string} wish - The wish or message from the user.
 */
function setupShare(name, wish) {
  const url = location.href.split('?')[0];
  const text = `${name} ‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ${wish}`;
  
  const lineBtn = document.getElementById('shareLine');
  const fbBtn = document.getElementById('shareFB');
  
  if (lineBtn) {
      lineBtn.href = `https://line.me/R/msg/text/?${encodeURIComponent(text + '\n' + url)}`;
  }
  if (fbBtn) {
    fbBtn.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
  }
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
document.addEventListener('DOMContentLoaded', async () => {
  // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å URL
  const params = new URLSearchParams(location.search);
  const userName = params.get('name') || '‡∏ú‡∏π‡πâ‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á';
  const userWish = params.get('wish') || '‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç';
  const userDesign = params.get('design') || 'assets/krathong1.PNG';
  
  // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  document.getElementById('wishDisplay').innerHTML = `
    <span class="name-highlight">${esc(userName)}</span> ‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡∏ß‡πà‡∏≤<br>
    "${esc(userWish)}"
  `;
  
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏£‡πå
  setupShare(userName, userWish);
  
  // ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const allKrathongs = await loadRecentKrathongs();
  
  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  if (allKrathongs.length > 0) {
    createFloatingKrathongs(allKrathongs);
  } else {
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    createFloatingKrathongs([{
      name: userName,
      wish: userWish,
      design: userDesign
    }]);
  }
});
</script><audio id="bgMusic"
       autoplay
       loop
       muted
       preload="auto"
       playsinline>
  <source src="assets/loykrathong.mp3" type="audio/mpeg">
</audio>

<button id="soundToggle" class="sound-btn">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>

<script>
(function(){
  const audio = document.getElementById('bgMusic');
  const btn = document.getElementById('soundToggle');

  // ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å localStorage
  const state = localStorage.getItem('music_state') || 'muted';
  audio.muted = (state === 'muted');
  
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏∏‡πà‡∏°
  function updateButton() {
    if (audio.muted) {
      btn.textContent = 'üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
      btn.classList.remove('playing');
    } else {
      btn.textContent = 'üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
      btn.classList.add('playing');
    }
  }
  
  updateButton();

  // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  audio.play().catch(()=>{});

  // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  btn.addEventListener('click', async () => {
    try {
      if (audio.paused) await audio.play();
      audio.muted = !audio.muted;
      localStorage.setItem('music_state', audio.muted ? 'muted' : 'unmuted');
      updateButton();
    } catch {
      alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    }
  });

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  window.addEventListener('click', async function once(){
    if (localStorage.getItem('music_state') === 'unmuted') {
      try { 
        await audio.play(); 
        audio.muted = false; 
        updateButton();
      } catch{}
    }
    window.removeEventListener('click', once);
  }, {once:true});
})();
</script>

<style>
/* ===== ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ===== */
.sound-btn {
  position: fixed;
  right: 20px;
  bottom: 20px;
  z-index: 9999;
  background: linear-gradient(135deg, #ff9f0a 0%, #ff6b00 100%);
  color: #fff;
  border: 3px solid rgba(255,255,255,0.3);
  border-radius: 50px;
  padding: 14px 24px;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 
    0 4px 15px rgba(255,159,10,0.4),
    0 0 20px rgba(255,159,10,0.2),
    inset 0 1px 0 rgba(255,255,255,0.2);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  animation: pulse 2s ease-in-out infinite;
}

.sound-btn:hover {
  background: linear-gradient(135deg, #ff8800 0%, #ff5500 100%);
  transform: scale(1.1) translateY(-2px);
  box-shadow: 
    0 6px 25px rgba(255,159,10,0.6),
    0 0 30px rgba(255,159,10,0.3),
    inset 0 1px 0 rgba(255,255,255,0.3);
  border-color: rgba(255,255,255,0.5);
}

.sound-btn:active {
  transform: scale(1.05) translateY(0);
  box-shadow: 0 2px 10px rgba(255,159,10,0.3);
}

@keyframes pulse {
  0%, 100% {
    box-shadow: 
      0 4px 15px rgba(255,159,10,0.4),
      0 0 20px rgba(255,159,10,0.2),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }
  50% {
    box-shadow: 
      0 4px 20px rgba(255,159,10,0.6),
      0 0 30px rgba(255,159,10,0.4),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }
}

.sound-btn.playing {
  animation: none;
  background: linear-gradient(135deg, #00d4aa 0%, #00a884 100%);
  box-shadow: 
    0 4px 15px rgba(0,212,170,0.4),
    0 0 20px rgba(0,212,170,0.2),
    inset 0 1px 0 rgba(255,255,255,0.2);
}

.sound-btn.playing:hover {
  background: linear-gradient(135deg, #00c49a 0%, #009874 100%);
  box-shadow: 
    0 6px 25px rgba(0,212,170,0.6),
    0 0 30px rgba(0,212,170,0.3),
    inset 0 1px 0 rgba(255,255,255,0.3);
}

</style>
</body>
</html>