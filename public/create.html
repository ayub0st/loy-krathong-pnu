<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏á</title>
<link rel="stylesheet" href="styles.css">
<script src="sound.js" defer></script>
<style>
/* Responsive improvements */
.krathong-head {
  padding: 20px;
  text-align: center;
}

.krathong-head h1 {
  font-size: clamp(1.5rem, 5vw, 2.2rem);
  margin: 10px 0;
}

.krathong-head .subtitle {
  font-size: clamp(0.9rem, 3vw, 1.1rem);
  opacity: 0.9;
}

.card {
  max-width: 680px;
  margin: 20px auto;
  padding: clamp(16px, 4vw, 24px);
}

.card label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: clamp(0.95rem, 2.5vw, 1.05rem);
}

.card input,
.card textarea {
  width: 100%;
  padding: clamp(10px, 2.5vw, 14px);
  font-size: clamp(0.9rem, 2.5vw, 1rem);
}

.card textarea {
  min-height: clamp(100px, 20vh, 140px);
}

.designs {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: clamp(10px, 2vw, 14px);
  margin: 12px 0;
}

.design {
  padding: clamp(8px, 2vw, 12px);
  cursor: pointer;
  transition: all 0.3s;
}

.design:hover {
  background: rgba(255,255,255,0.1);
  transform: scale(1.05);
}

.design img {
  width: 100%;
  max-width: 120px;
  height: auto;
  aspect-ratio: 1;
  object-fit: contain;
  margin: 0 auto;
  display: block;
}

.design input[type="radio"] {
  width: auto;
  margin: 8px auto 0;
  cursor: pointer;
}

.design label {
  font-size: clamp(0.85rem, 2vw, 0.95rem);
  text-align: center;
  display: block;
  margin-top: 6px;
  cursor: pointer;
}

.btn {
  width: 100%;
  max-width: 100%;
  padding: clamp(12px, 3vw, 16px);
  font-size: clamp(1rem, 2.5vw, 1.1rem);
  font-weight: 600;
  margin-top: 10px;
}

@media (max-width: 480px) {
  .designs {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .design img {
    max-width: 90px;
  }
}

/* Loading state */
.btn.loading {
  opacity: 0.7;
  pointer-events: none;
  position: relative;
}

.btn.loading::after {
  content: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: inherit;
}
</style>
</head>
<body>

<div class="krathong-head">
  <h1>ü™î ‡∏°‡∏≤‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏Å‡∏±‡∏ô!</h1>
  <p class="subtitle">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏¢‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</p>
</div>

<form id="formKrathong" class="card">
  <label for="name">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
  <input 
    type="text" 
    id="name" 
    name="name" 
    placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" 
    required 
    maxlength="80"
    autocomplete="name"
  >
  
  <label for="wish" style="margin-top: 16px;">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô</label>
  <textarea 
    id="wish" 
    name="wish" 
    placeholder="‡∏Ç‡∏≠‡πÉ‡∏´‡πâ..." 
    required 
    maxlength="1000"
  ></textarea>
  
  <label style="margin-top: 16px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏á</label>
  <div class="designs">
    <div class="design">
      <input 
        type="radio" 
        name="design" 
        id="design1" 
        value="assets/krathong1.svg" 
        checked
      >
      <label for="design1">
        <img src="assets/krathong1.svg" alt="‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1">
        ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1
      </label>
    </div>
    
    <div class="design">
      <input 
        type="radio" 
        name="design" 
        id="design2" 
        value="assets/krathong2.svg"
      >
      <label for="design2">
        <img src="assets/krathong2.svg" alt="‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2">
        ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2
      </label>
    </div>
    
    <div class="design">
      <input 
        type="radio" 
        name="design" 
        id="design3" 
        value="assets/krathong3.svg"
      >
      <label for="design3">
        <img src="assets/krathong3.svg" alt="‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3">
        ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3
      </label>
    </div>
  </div>
  
  <button type="submit" class="btn" id="submitBtn">‡∏•‡∏≠‡∏¢‡πÄ‡∏•‡∏¢</button>
  <a class="btn ghost" href="index.html">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
</form>

<footer class="foot">
  <small>¬© 2025 Loy Krathong Online by Ayub</small>
</footer>
<iframe src="music.html" allow="autoplay" style="display:none"></iframe>
<script>
const API = "api";

async function postJSON(url, data) {
  const r = await fetch(url, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  });
  
  if (!r.ok) {
    const text = await r.text().catch(() => '');
    throw new Error(`HTTP ${r.status}: ${text}`);
  }
  
  return r.json();
}

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('formKrathong');
  const submitBtn = document.getElementById('submitBtn');
  
  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å radio ‡πÑ‡∏î‡πâ
  document.querySelectorAll('.design label').forEach(label => {
    label.addEventListener('click', (e) => {
      const radioId = label.getAttribute('for');
      if (radioId) {
        document.getElementById(radioId).checked = true;
      }
    });
  });
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const name = document.getElementById('name').value.trim();
    const wish = document.getElementById('wish').value.trim();
    const design = document.querySelector('input[name=design]:checked').value;
    
    // Validate
    if (!name || !wish) {
      alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô');
      return;
    }
    
    if (name.length > 80) {
      alert('‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 80 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)');
      return;
    }
    
    if (wish.length > 1000) {
      alert('‚ùå ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)');
      return;
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á loading
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    try {
      const res = await postJSON(`${API}/submit.php`, {name, wish, design});
      
      if (!res.ok) {
        throw new Error(res.error || 'UNKNOWN_ERROR');
      }
      
      // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á
      const params = new URLSearchParams({name, wish, design});
      location.href = `float.html?${params.toString()}`;
      
    } catch(e) {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
      
      let errorMsg = '‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n';
      
      if (e.message.includes('RATE_LIMIT')) {
        errorMsg += '‡∏Ñ‡∏∏‡∏ì‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
      } else if (e.message.includes('405')) {
        errorMsg += '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö API';
      } else if (e.message.includes('Failed to fetch')) {
        errorMsg += '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
      } else {
        errorMsg += e.message;
      }
      
      alert(errorMsg);
    }
  });
});
</script>
<audio id="bgMusic"
       autoplay
       loop
       muted
       preload="auto"
       playsinline>
  <source src="assets/loykrathong.mp3" type="audio/mpeg">
</audio>

<button id="soundToggle" class="sound-btn">üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>

<script>
(function(){
  const audio = document.getElementById('bgMusic');
  const btn = document.getElementById('soundToggle');

  // ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å localStorage
  const state = localStorage.getItem('music_state') || 'muted';
  audio.muted = (state === 'muted');
  btn.textContent = audio.muted ? 'üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á' : 'üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';

  // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ö‡∏≤‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ gesture)
  audio.play().catch(()=>{});

  // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
  btn.addEventListener('click', async () => {
    try {
      if (audio.paused) await audio.play(); // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÇ‡∏î‡∏ô policy
      audio.muted = !audio.muted;
      localStorage.setItem('music_state', audio.muted ? 'muted' : 'unmuted');
      btn.textContent = audio.muted ? 'üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á' : 'üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
    } catch {
      alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
    }
  });

  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢ unmuted
  window.addEventListener('click', async function once(){
    if (localStorage.getItem('music_state') === 'unmuted') {
      try { await audio.play(); audio.muted = false; } catch{}
      btn.textContent = 'üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
    }
    window.removeEventListener('click', once);
  }, {once:true});
})();
</script>

<style>
.sound-btn {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 9999;
  background: rgba(255,159,10,0.95);
  color: #fff;
  border: none;
  border-radius: 25px;
  padding: 10px 18px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.25);
  transition: all .25s ease;
}
.sound-btn:hover {
  background: rrgba(255,159,10,0.95);
  transform: scale(1.05);
}
</style>
</body>
</html>